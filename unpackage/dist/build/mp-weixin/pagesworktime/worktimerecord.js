(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["pagesworktime/worktimerecord"],{"05bc":function(t,e,i){"use strict";(function(t){function i(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;t||(t=new Date),"object"!==typeof t&&(t=t.replace(/-/g,"/"));var i=new Date(t);i.setDate(i.getDate()+e);var o=i.getFullYear(),r=i.getMonth()+1<10?"0"+(i.getMonth()+1):i.getMonth()+1,a=i.getDate()<10?"0"+i.getDate():i.getDate();return{fullDate:o+"-"+r+"-"+a,year:o,month:r,date:a,day:i.getDay()}}Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var o={data:function(){return{showLoading:!0,paddingBottom:"400upx",day:"2022-08-27",salaryType:-1,description:"",dayOrNight:0,workTypeList:[{value:0,text:"早班"},{value:1,text:"中班"},{value:2,text:"晚班"},{value:3,text:"白班"},{value:4,text:"夜班"},{value:5,text:"休息"}],workType:3,dayHour:0,workRatioList:[{value:1,text:"不加班1倍"},{value:1.5,text:"平时加班1.5倍"},{value:2,text:"周六日加班2倍"},{value:3,text:"节假日3倍"}],hourWorkConfig:{},commonWorkConfig:{},horizontal:"right",vertical:"top",direction:"horizontal",pattern:{color:"#7A7E83",backgroundColor:"#fff",selectedColor:"#007AFF",buttonColor:"#007AFF",iconColor:"#fff"},content:[{iconPath:"/static/images/delete.png",selectedIconPath:"/static/images/delete-active.png",text:"删除这条",active:!1},{iconPath:"/static/images/clock.png",selectedIconPath:"/static/images/clock-active.png",text:"小时工",active:!1},{iconPath:"/static/images/card.png",selectedIconPath:"/static/images/card-active.png",text:"正式工",active:!1},{iconPath:"/static/images/piece.png",selectedIconPath:"/static/images/piece-active.png",text:"计件工",active:!1}],currentId:0,historyDate:"",currentDate:"",hourList:[],currentIndex:-1,workRatio:1,actualSalary:0,hourPrice:0,pieceWorkConfig:{},jobTypeList:[{value:1,text:"前锋"},{value:2,text:"后锋"}],isDisabled:!1,commonDayHour:0,dayType:2,showFab:!0}},computed:{workPrice:function(){if(2!==this.salaryType)return Math.floor(this.hourPrice*this.workRatio*100)/100},salary:function(){if(2!==this.salaryType){var t=this.commonDayHour*this.hourPrice;2!==this.dayType&&1===this.salaryType&&(t=0);var e=1*this.overtimeSalary;0===this.salaryType&&(t=this.dayHour*this.hourPrice,e=0);var i=Math.floor(100*(t+e))/100;return i}},jobSalaryTotal:function(){var t=0;return this.pieceWorkConfig.pieceWorkList&&this.pieceWorkConfig.pieceWorkList.forEach((function(e){t+=e.jobSalary})),Math.round(100*t)/100},showOvertime:function(){return 2==this.dayType&&this.dayHour>this.commonDayHour||3==this.dayType||4==this.dayType},overtimeLong:function(){return 2==this.dayType?(this.dayHour-this.commonDayHour).toFixed(2):this.dayHour.toFixed(2)},overtimeSalary:function(){return(Math.round(this.overtimeLong*this.workPrice*100)/100).toFixed(2)}},watch:{salary:function(t){this.actualSalary=t},dayHour:function(t){this.currentIndex=this.hourList.indexOf(t),2==this.dayType&&1===this.salaryType&&(t>this.commonDayHour?this.workRatio=this.workRatioList[1].value:this.workRatio=this.workRatioList[0].value)},currentIndex:function(t){}},created:function(){for(var t=.5;t<=24;t+=.5)this.hourList.push(t)},onLoad:function(e){var o=this;this.salaryType=1*e.type;var r=e.date;r||(r=i().fullDate),this.currentDate=this.historyDate=this.day=r;var a="小时工记录工时";1===this.salaryType?a="正式工记录工时":2===this.salaryType&&(a="计件工记录工时"),t.setNavigationBarTitle({title:a}),1===this.salaryType&&this.$Request.get(this.$api.worktime.get_overtime_ratio,{salaryType:this.salaryType}).then((function(t){t.data&&(o.workRatioList=t.data)})),r&&this.requestData()},onBackPress:function(t){return console.error(t),!!this.$refs.fab.isShow&&(this.$refs.fab.close(),!0)},methods:{getWorkRatio:function(){if(2!==this.salaryType){var t=1,e=0===this.salaryType?"hourWorkConfig":"commonWorkConfig";switch(this.workType){case 1:default:t=this[e].dayWorkRatio;break;case 2:t=this[e].nightWorkRatio;break;case 3:t=this[e].weekendWorkRatio;break;case 4:t=this[e].holidayWorkRatio}return t}},formSubmit:function(e){var i=this,o=e.detail.value,r=(new Date).getFullYear(),a=(new Date).getMonth()+1,n=(new Date).getDate(),s=new Date(this.currentDate).getFullYear(),c=new Date(this.currentDate).getMonth()+1,u=new Date(this.currentDate).getDate();if(r<s||r===s&&a<c||r===s&&a===c&&n<u)this.$Common.toast("不可记录大于今日的工时");else{var h={};switch(this.currentId&&(h.id=this.currentId),h.date=this.currentDate,h.salaryType=this.salaryType,this.salaryType){case 0:h.dayHour=1*o.dayHour,h.workType=this.workType,h.salary=1*o.salary,h.remark=o.description;break;case 1:default:h.dayHour=1*o.dayHour,h.workType=this.workType,h.salary=1*o.salary,h.remark=o.description,h.workRatio=1*this.workRatio;break;case 2:this.pieceWorkConfig.pieceWorkList.map((function(t){t.jobNum*=1})),h.workList=this.pieceWorkConfig.pieceWorkList,h.workType=this.workType,h.salary=o.jobSalaryTotal,h.remark=o.description}this.$Request.post(this.$api.worktime.record_work_time,h,{"content-type":"multipart/form-data"}).then((function(e){i.$Common.toast(e.msg),1==e.code&&(t.$emit("update",i.currentDate),t.navigateBack({delta:1}))}))}},selectWorkRatio:function(t){this.workRatio=t},trigger:function(e){var i=this;if(e){this.content[e.index].active=!0,this.content.map((function(t,i){i!==e.index&&(t.active=!1)}));var o=this.currentId?e.index-1:e.index;if(this.salaryType===o)return;if(this.currentId&&0===e.index)return void this.$Request.post(this.$api.worktime.delete_salary_record,{id:this.currentId}).then((function(e){i.$Common.toast(e.msg),1==e.code&&(t.$emit("update",i.currentDate),t.navigateBack({delta:1}))}));setTimeout((function(){t.redirectTo({url:"./worktimerecord?type="+o})}),1e3)}},fabClick:function(t){this.currentId||"删除这条"!==this.content[0].text||this.$delete(this.content,0),this.currentId&&"删除这条"!==this.content[0].text&&this.content.unshift({iconPath:"/static/images/delete.png",selectedIconPath:"/static/images/delete-active.png",text:"删除这条",active:!1}),this.currentId?this.content[this.salaryType+1].active=!0:this.content[this.salaryType].active=!0},selectHour:function(t){this.isDisabled||(this.currentIndex=t,this.dayHour=this.hourList[t])},inputJobNum:function(t,e){var i=this.pieceWorkConfig.pieceWorkList[e];i.jobSalary=Math.round(t*i.jobPrice*100)/100,this.$set(this.pieceWorkConfig.pieceWorkList,e,i)},inputJobSalary:function(t,e){var i=this.pieceWorkConfig.pieceWorkList[e];i.jobSalary=Math.round(100*t)/100,this.$set(this.pieceWorkConfig.pieceWorkList,e,i)},selectDate:function(t){var e=this;this.showFab=!1,setTimeout((function(){e.showFab=!0}),1),this.currentDate=this.day=t,this.requestData()},selectWorkType:function(t){if(console.error(this.dayOrNight),console.error(t),this.workType=t,5===t){if(this.dayHour=0,this.actualSalary=0,2===this.salaryType){var e=this.pieceWorkConfig;e.pieceWorkList.map((function(t){t.jobNum=0,t.jobSalary=0})),this.pieceWorkConfig=Object.assign({},e)}this.isDisabled=!0}else this.isDisabled=!1},reduce:function(){this.isDisabled||(this.dayHour=Math.round(100*(this.dayHour-=.1))/100,this.dayHour<=.1&&(this.dayHour=.1))},increase:function(){this.isDisabled||(this.dayHour=Math.round(100*(this.dayHour+=.1))/100,this.dayHour>=24&&(this.dayHour=24))},requestData:function(){var e=this,i=this;this.$Request.get(this.$api.worktime.get_current_record,{salaryType:this.salaryType,date:this.currentDate}).then((function(o){if(0!=o.code){if(o.data){switch(5==o.data.workType?e.isDisabled=!0:e.isDisabled=!1,e.salaryType){case 0:e.hourWorkConfig=o.data,e.currentId=e.hourWorkConfig.id?e.hourWorkConfig.id:0,e.dayHour=5==e.hourWorkConfig.workType?0:e.hourWorkConfig.hourLong,e.dayOrNight=e.hourWorkConfig.workType,e.hourPrice=e.hourWorkConfig.hourPrice,e.description=e.hourWorkConfig.remark,e.showLoading=!1,e.workRatio=1;break;case 1:default:e.commonWorkConfig=o.data,e.currentId=e.commonWorkConfig.id?e.commonWorkConfig.id:0,e.commonDayHour=e.commonWorkConfig.commonDayHour,e.dayHour=5==e.hourWorkConfig.workType?0:e.commonWorkConfig.hourLong+e.commonWorkConfig.overtimeHourLong,e.dayOrNight=e.commonWorkConfig.workType,e.hourPrice=e.commonWorkConfig.hourPrice,e.workRatio=e.commonWorkConfig.currentRatio,e.dayType=e.commonWorkConfig.dayType,e.description=e.commonWorkConfig.remark,e.showLoading=!1;break;case 2:e.pieceWorkConfig=o.data,e.currentId=e.pieceWorkConfig.id?e.pieceWorkConfig.id:0,e.dayOrNight=e.pieceWorkConfig.workType,e.description=e.pieceWorkConfig.remark,e.pieceWorkConfig.pieceWorkList.map((function(t){t.jobSalary=Math.round(t.jobNum*t.jobPrice*100)/100})),e.showLoading=!1}e.$nextTick((function(){o.data.salary&&(e.actualSalary=5==e.hourWorkConfig.workType?0:1*o.data.salary)}))}}else t.showModal({title:e.$Config("APPNAME"),content:o.msg,showCancel:!1,confirmText:"立即设置",success:function(e){e.confirm&&t.redirectTo({url:"/pagesworktime/salarysettings?type="+i.salaryType})}})}))},resetClick:function(t){this.currentDate=this.day=this.historyDate,this.requestData()}}};e.default=o}).call(this,i("543d")["default"])},"0c4f":function(t,e,i){"use strict";var o=i("68d7"),r=i.n(o);r.a},"68d7":function(t,e,i){},8152:function(t,e,i){"use strict";i.r(e);var o=i("05bc"),r=i.n(o);for(var a in o)"default"!==a&&function(t){i.d(e,t,(function(){return o[t]}))}(a);e["default"]=r.a},"8bf0":function(t,e,i){"use strict";i.r(e);var o=i("98ce"),r=i("8152");for(var a in r)"default"!==a&&function(t){i.d(e,t,(function(){return r[t]}))}(a);i("0c4f");var n,s=i("f0c5"),c=Object(s["a"])(r["default"],o["b"],o["c"],!1,null,null,null,!1,o["a"],n);e["default"]=c.exports},"98ce":function(t,e,i){"use strict";i.d(e,"b",(function(){return r})),i.d(e,"c",(function(){return a})),i.d(e,"a",(function(){return o}));var o={uniDatetimePicker:function(){return Promise.all([i.e("common/vendor"),i.e("uni_modules/uni-datetime-picker/components/uni-datetime-picker/uni-datetime-picker")]).then(i.bind(null,"161b"))},uniDataSelect:function(){return Promise.all([i.e("common/vendor"),i.e("uni_modules/uni-data-select/components/uni-data-select/uni-data-select")]).then(i.bind(null,"4a8c"))},uniFab:function(){return i.e("uni_modules/uni-fab/components/uni-fab/uni-fab").then(i.bind(null,"03be"))}},r=function(){var t=this,e=t.$createElement;t._self._c},a=[]},e745:function(t,e,i){"use strict";(function(t){i("652a");o(i("66fd"));var e=o(i("8bf0"));function o(t){return t&&t.__esModule?t:{default:t}}wx.__webpack_require_UNI_MP_PLUGIN__=i,t(e.default)}).call(this,i("543d")["createPage"])}},[["e745","common/runtime","common/vendor"]]]);