(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["pagesworktime/salarysettings"],{"1ce9":function(t,e,i){"use strict";(function(t){Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var i={data:function(){return{title:"工资设置",salaryType:-1,hourworkList:[],periodIndex:0,range:["1号-本月底","2号-下月1号","3号-下月2号","4号-下月3号","5号-下月4号","6号-下月5号","7号-下月6号","8号-下月7号","9号-下月8号","10号-下月9号","11号-下月10号","12号-下月11号","13号-下月12号","14号-下月13号","15号-下月14号","16号-下月15号","17号-下月16号","18号-下月17号","19号-下月18号","20号-下月19号","21号-下月20号","22号-下月21号","23号-下月22号","24号-下月23号","25号-下月24号","26号-下月25号","27号-下月26号","28号-下月27号","29号-下月28号"],hourWorkTitle:"",fulltimeWorkSalary:0,monthDay:21.75,dayWorkLong:8,commonWorkRatio:1.5,hourWorkWeekendRatio:2,hourWorkHolidayRatio:3,pieceWorkTitle:"",pieceWorkUnit:"",pieceWorkPrice:"",workRuleList:[],givenHourWorkPrice:0,currentObjId:0,currentObjIndex:-1,showLoading:!0}},computed:{hourWorkPrice:{get:function(){return this.givenHourWorkPrice?this.givenHourWorkPrice:Math.floor(this.fulltimeWorkSalary/this.monthDay/this.dayWorkLong*100)/100},set:function(t){console.error(t)}},commonWorkPrice:function(){return Math.floor(this.hourWorkPrice*this.commonWorkRatio*100)/100},hourWorkWeekendPrice:function(){return Math.floor(this.hourWorkPrice*this.hourWorkWeekendRatio*100)/100},hourWorkHolidayPrice:function(){return Math.floor(this.hourWorkPrice*this.hourWorkHolidayRatio*100)/100}},watch:{pieceWorkUnit:function(t){},hourworkList:function(t){t.length>0&&(this.pieceWorkUnit=t[0].unit)},fulltimeWorkSalary:function(t){1*t>9999999&&(this.$Common.toast("您的月薪似乎过高了！"),this.fulltimeWorkSalary=9999999)}},onLoad:function(e){var i=this,o=this.salaryType=1*e.type,r="";switch(o){case 0:default:r="小时工工资设置";break;case 1:r="正式工资设置";break;case 2:r="计件工资设置"}t.setNavigationBarTitle({title:r});var n={};this.currentObjId&&(n.id=this.currentObjId),n.salaryType=this.salaryType,this.$Request.get(this.$api.worktime.get_salary_settings,n).then((function(t){t.data&&i.giveValue(t.data),i.showLoading=!1}))},onShow:function(){},methods:{selectDateRange:function(e){var i=this,o={id:this.currentObjId,salaryType:this.salaryType,period:1*e.detail.value};this.$Request.post(this.$api.worktime.set_single_work_time,o).then((function(o){o&&(1==o.code&&(t.$emit("updateSetting","KQ"),i.periodIndex=1*e.detail.value),i.$Common.toast(o.msg))}))},addHourSetting:function(){var t="tips"+this.salaryType;this.pieceWorkTitle="",this.pieceWorkUnit="",this.pieceWorkPrice="",this.currentObjId=0,this.currentObjIndex=-1,this.$refs[t].open()},workRuleGenerate:function(){var t=[];for(var e in this.workRuleList){if(!this.workRuleList[e].fullDay||!this.workRuleList[e].fullMoney)return this.$Common.toast("全勤天数或全勤奖励不可为0，请填写或者删除全勤规则"),!1;if(this.workRuleList[e].fullDay>31)return this.$Common.toast("全勤天数不能大于31天"),!1;if(t.indexOf(this.workRuleList[e].fullDay)>-1)return this.$Common.toast("考勤天数".concat(this.workRuleList[e].fullDay,"已存在")),!1;t.push(this.workRuleList[e].fullDay)}var i=[];return this.workRuleList.forEach((function(t){i.push({fullDay:1*t.fullDay,fullMoney:1*t.fullMoney})})),i},formSubmit:function(e){var i=this,o={};this.currentObjId&&(o.id=this.currentObjId),o.salaryType=this.salaryType,o.period=this.periodIndex;var r=[];if(r=this.workRuleGenerate()){switch(o.workRuleList=r,this.salaryType){case 1:default:if(o.fulltimeWorkSalary=1*e.detail.value.fulltimeWorkSalary,o.monthDay=1*e.detail.value.monthDay,o.dayWorkLong=1*e.detail.value.dayWorkLong,o.hourWorkPrice=1*e.detail.value.hourWorkPrice,o.commonWorkRatio=1*e.detail.value.commonWorkRatio,o.hourWorkWeekendRatio=1*e.detail.value.hourWorkWeekendRatio,o.hourWorkHolidayRatio=1*e.detail.value.hourWorkHolidayRatio,console.error(o),!o.fulltimeWorkSalary||!o.monthDay||!o.dayWorkLong||!o.hourWorkPrice||!o.commonWorkRatio||!o.hourWorkWeekendRatio||!o.hourWorkHolidayRatio)return void this.$Common.toast("必填项不可为空");break;case 0:o.hourWorkPrice=1*e.detail.value.hourWorkPrice,o.hourWorkPrice||this.$Common.toast("必填项不可为空");break}this.$Request.post(this.$api.worktime.set_salary_settings,o,{"content-type":"multipart/form-data"}).then((function(e){i.$Common.toast(e.msg),1==e.code&&(t.$emit("updateSetting"),t.navigateBack({delta:1}))}))}},submitWorkRule:function(){var e=this,i=[];if(!1!==(i=this.workRuleGenerate())){var o={salaryType:this.salaryType,workRuleList:i};this.$Request.post(this.$api.worktime.set_work_rule,o,{"content-type":"multipart/form-data"}).then((function(i){e.$Common.toast(i.msg),1==i.code&&t.$emit("updateSetting")}))}},addNewConfig:function(e){var i=this,o=e.detail.value,r={};if(this.pieceWorkUnit=o.pieceWorkUnit,o.pieceWorkTitle&&o.pieceWorkUnit&&o.pieceWorkPrice){for(var n in this.hourworkList)if(this.hourworkList[n].name===o.pieceWorkTitle&&this.currentObjIndex!=n)return void this.$Common.toast("列表中已存在".concat(o.pieceWorkTitle));r={name:o.pieceWorkTitle,unit:o.pieceWorkUnit,price:(1*o.pieceWorkPrice).toFixed(2)},this.currentObjId&&(r.id=this.currentObjId),r.salaryType=this.salaryType,r.period=this.periodIndex,this.$Request.post(this.$api.worktime.set_salary_settings,r,{"content-type":"multipart/form-data"}).then((function(e){if(i.$Common.toast(e.message),1==e.code){if(i.currentObjId){var o=i.hourworkList;o[i.currentObjIndex]=r,i.hourworkList=o}else r.id=100*Math.random(),i.hourworkList.push(r);i.currentObjId=0,i.currentObjIndex=-1,i.$refs.tips2.close(),t.$emit("updateSetting")}}))}else this.$Common.toast("必填项不可为空")},checktitle:function(t){t.length>30&&this.$Common.toast("姓名不能超过30个字符")},titleblur:function(t){t.length<1&&this.$Common.toast("内容不能少于2个字符")},edit:function(t,e){this.pieceWorkTitle=this.hourworkList[e].name,this.pieceWorkUnit=this.hourworkList[e].unit,this.pieceWorkPrice=this.hourworkList[e].price,this.currentObjId=t,this.currentObjIndex=e,this.$refs.tips2.open()},del:function(e,i){var o=this;this.$Request.post(this.$api.worktime.delete_salary_setting,{id:e}).then((function(e){o.$Common.toast(e.msg),1==e.code&&(t.$emit("updateSetting"),o.$delete(o.hourworkList,i))}))},addRule:function(){console.error(this.workRuleList),this.workRuleList.length>4?this.$Common.toast("全勤规则不能超过5条"):this.workRuleList.push({fullDay:0,fullMoney:0})},delRule:function(t,e){this.$delete(this.workRuleList,e)},giveValue:function(t){var e=this;if(0===this.salaryType||1===this.salaryType)try{t.full_work_setting=JSON.parse(t.full_work_setting)}catch(i){t.full_work_setting=[]}0===this.salaryType?(this.currentObjId=t.work_setting_id,this.givenHourWorkPrice=t.hour_salary,this.periodIndex=t.work_period,this.workRuleList=t.full_work_setting):1===this.salaryType?(this.currentObjId=t.work_setting_id,this.fulltimeWorkSalary=t.month_salary,this.monthDay=t.month_day,this.dayWorkLong=t.work_day_hour,this.givenHourWorkPrice=t.hour_salary,this.commonWorkRatio=t.common_ratio,this.hourWorkWeekendRatio=t.weekend_ratio,this.hourWorkHolidayRatio=t.holiday_ratio,this.periodIndex=t.work_period,this.workRuleList=t.full_work_setting):(t[0]&&(this.periodIndex=t[0].work_period),this.hourworkList=t.map((function(t){var o={};if(o.id=t.work_setting_id,o.name=t.work_name,o.unit=t.work_unit,o.price=t.work_price,t.full_work_setting&&0===e.workRuleList.length){console.error(t.full_work_setting),console.error(e.workRuleList);try{t.full_work_setting=JSON.parse(t.full_work_setting)}catch(i){t.full_work_setting=[]}e.workRuleList=t.full_work_setting}return o})))}}};e.default=i}).call(this,i("543d")["default"])},"1ecd":function(t,e,i){},4022:function(t,e,i){"use strict";var o=i("1ecd"),r=i.n(o);r.a},"9c58":function(t,e,i){"use strict";i.r(e);var o=i("dd50"),r=i("fb20");for(var n in r)"default"!==n&&function(t){i.d(e,t,(function(){return r[t]}))}(n);i("4022");var s,a=i("f0c5"),u=Object(a["a"])(r["default"],o["b"],o["c"],!1,null,null,null,!1,o["a"],s);e["default"]=u.exports},dd50:function(t,e,i){"use strict";i.d(e,"b",(function(){return r})),i.d(e,"c",(function(){return n})),i.d(e,"a",(function(){return o}));var o={uniIcons:function(){return Promise.all([i.e("common/vendor"),i.e("components/uni-icons/uni-icons")]).then(i.bind(null,"17fc"))},uniPopup:function(){return i.e("components/uni-popup/uni-popup").then(i.bind(null,"b7f7"))}},r=function(){var t=this,e=t.$createElement;t._self._c;t._isMounted||(t.e0=function(e){t.givenHourWorkPrice=0},t.e1=function(e){t.givenHourWorkPrice=0},t.e2=function(e){t.givenHourWorkPrice=0})},n=[]},f983:function(t,e,i){"use strict";(function(t){i("652a");o(i("66fd"));var e=o(i("9c58"));function o(t){return t&&t.__esModule?t:{default:t}}wx.__webpack_require_UNI_MP_PLUGIN__=i,t(e.default)}).call(this,i("543d")["createPage"])},fb20:function(t,e,i){"use strict";i.r(e);var o=i("1ce9"),r=i.n(o);for(var n in o)"default"!==n&&function(t){i.d(e,t,(function(){return o[t]}))}(n);e["default"]=r.a}},[["f983","common/runtime","common/vendor"]]]);