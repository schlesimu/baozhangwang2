(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["pagesworktime/worktimestatistics"],{3249:function(e,t,r){"use strict";r.r(t);var n=r("74aa"),a=r.n(n);for(var o in n)"default"!==o&&function(e){r.d(t,e,(function(){return n[e]}))}(o);t["default"]=a.a},"4c48":function(e,t,r){"use strict";r.r(t);var n=r("ab3b"),a=r("3249");for(var o in a)"default"!==o&&function(e){r.d(t,e,(function(){return a[e]}))}(o);r("503d");var i,s=r("f0c5"),h=Object(s["a"])(a["default"],n["b"],n["c"],!1,null,null,null,!1,n["a"],i);t["default"]=h.exports},"503d":function(e,t,r){"use strict";var n=r("a084"),a=r.n(n);a.a},"74aa":function(e,t,r){"use strict";(function(e){function r(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;e||(e=new Date),"object"!==typeof e&&(e=e.replace(/-/g,"/"));var r=new Date(e);r.setDate(r.getDate()+t);var n=r.getFullYear(),a=r.getMonth()+1<10?"0"+(r.getMonth()+1):r.getMonth()+1,o=r.getDate()<10?"0"+r.getDate():r.getDate();return{fullDate:n+"-"+a+"-"+o,year:n,month:a,date:o,day:r.getDay()}}Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var n={data:function(){return{salaryType:"",currentTab:0,tabList:[{index:1,title:"按考勤周期"},{index:2,title:"按月查看"},{index:3,title:"按指定范围查看"}],workRange:[],range:[],settingWorkIndex:0,workIndex:-1,direction:1,hourworkList:[],hourWork:{},commonWork:{},worktimerecord:"/pagesworktime/worktimerecord",userinfo:e.getStorageSync("USERINFO"),info:{date:"2022-09-10",startDate:"",endDate:"",lunar:!0,range:!1,selected:[]},area:{date:"2019-09-10",startDate:"",endDate:"",lunar:!0,range:!0,insert:!1,selected:[]},currentYear:"",currentYearShow:"",currentMonth:"",currentRange:"",oldRangeIndex:0,oldMonthIndex:0,showCanlendar:!1,showLoading:!0,fullWorkDay:0,fullWorkSalary:0,showBtn:!0,rangeMonth:0,showFullDay:!0,showDateRange:!1,dateRange:""}},computed:{unit:function(){return this.hourworkList.length>0?this.hourworkList[0].unit:"件"},totalSum:function(){var e=0;return this.hourworkList.forEach((function(t){e+=t.count})),e},totalSalary:function(){var e=0;return this.hourworkList.forEach((function(t){e+=t.price*t.count})),e+this.fullWorkSalary},hourWorkHourPrice:function(){var e="hourWork";return 1===this.salaryType&&(e="commonWork"),this[e].hourPrice},hourWorkHour:function(){var e="hourWork";return 1===this.salaryType&&(e="commonWork"),this[e].hour},hourWorkCommon:function(){var e="hourWork";return 1===this.salaryType&&(e="commonWork"),this[e].common},hourWorkWeekend:function(){var e="hourWork";return 1===this.salaryType&&(e="commonWork"),this[e].weekend},hourWorkHoliday:function(){var e="hourWork";return 1===this.salaryType&&(e="commonWork"),this[e].holiday},hourWorkSum:function(){var e="hourWork";1===this.salaryType&&(e="commonWork");var t=this[e],r=t.hour,n=t.common,a=t.weekend,o=t.holiday;return r+n+a+o},hourWorkDay:function(){var e="hourWork";return 1===this.salaryType&&(e="commonWork"),this[e].day},hourWorkTotal:function(){var e="hourWork";1===this.salaryType&&(e="commonWork");var t=this[e],r=t.hourPrice*t.hour,n=t.hourPrice*t.common*t.commonRatio,a=t.hourPrice*t.weekend*t.weekendRatio,o=t.hourPrice*t.holiday*t.holidayRatio,i=r+n+a+o+this.fullWorkSalary;return Math.round(100*i)/100},showData:function(){var e="hourWork";return 1===this.salaryType&&(e="commonWork"),Object.keys(this[e]).length}},watch:{currentTab:function(e){var t=this.currentYear,n="";this.workIndex=-1,0===e?(this.currentYearShow="",this.range=this.workRange,this.workIndex=this.oldRangeIndex,getApp().globalData.currentTab=0,this.$refs.calendar.uni_calendar_header_hide="",n=this.range[this.workIndex]):1===e?(this.currentYearShow=this.currentYear+"年",this.range=["1月","2月","3月","4月","5月","6月","7月","8月","9月","10月","11月","12月"],this.workIndex=this.oldMonthIndex,getApp().globalData.currentTab=1,this.$refs.calendar.uni_calendar_header_hide="uni-calendar__header_hide",n=this.range[this.workIndex]):(getApp().globalData.currentTab=2,n=this.currentMonth+"月",this.$set(this.area,"date",r(new Date).fullDate));var a=this.cnDateTransferEn(n);this.requestData(t,a)},workIndex:function(e){e===this.range.length&&2===this.direction&&(this.workIndex=0),-1===e&&1===this.direction&&(this.workIndex=this.range.length-1),0===this.currentTab&&(this.oldRangeIndex=e),1===this.currentTab&&(this.oldMonthIndex=e),this.generateRangeMonth()},range:function(){this.generateRangeMonth()}},beforeMount:function(){var e=(new Date).getFullYear(),t=(new Date).getMonth(),r=(new Date).getDate();this.range=[e+"年"+t+"月"+r+"日"]},onLoad:function(t){var r=this,n="",a=1*t.type;this.salaryType=a;this.currentYear=1*(new Date).getFullYear();switch(this.currentMonth=this.rangeMonth=1*(new Date).getMonth()+1,this.oldMonthIndex=["1月","2月","3月","4月","5月","6月","7月","8月","9月","10月","11月","12月"].indexOf(this.currentMonth+"月"),a){case 0:default:n="小时工工时统计";break;case 1:n="正式工工时统计";break;case 2:n="计件工工时统计"}e.setNavigationBarTitle({title:n}),this.$Request.get(this.$api.worktime.get_work_time_range).then((function(e){e.data&&(r.range=r.workRange=e.data,r.updateData())}))},onShow:function(){this.showCanlendar=!0},beforeUpdate:function(){e.$off("update"),this.$refs.uni_calendar_header_hide&&(0===this.currentTab?this.$refs.calendar.uni_calendar_header_hide="":1===this.currentTab&&(this.$refs.calendar.uni_calendar_header_hide="uni-calendar__header_hide"))},updated:function(){var t=this;e.$on("update",(function(){e.$emit("updateOn");var r=t.currentYear;1===t.currentTab&&(t.currentYearShow=t.currentYear+"年");var n=t.cnDateTransferEn(t.range[t.workIndex]);t.requestData(r,n)})),e.$on("updateSetting",(function(r){if(e.$emit("updateOn"),"KQ"!==r){var n=t.currentYear;1===t.currentTab&&(t.currentYearShow=t.currentYear+"年");var a=t.cnDateTransferEn(t.range[t.workIndex]);t.requestData(n,a)}else t.updateData()}))},onUnload:function(){this.showCanlendar=!1,this.showLoading=!1},onHide:function(){this.showCanlendar=!1,this.showLoading=!1},destroyed:function(){},methods:{updateData:function(){var t=this,r=this;this.$Request.get(this.$api.worktime.get_work_time_index,{salaryType:this.salaryType}).then((function(n){if(-1!=n.code){var a="";2!==t.currentTab?(t.workIndex=n.data?n.data:0,0===t.currentTab&&(t.settingWorkIndex=t.workIndex),a=t.range[t.workIndex]):a=t.currentMonth+"月";var o=t.cnDateTransferEn(a);t.requestData(t.currentYear,o)}else e.showModal({title:t.$Config("APPNAME"),content:n.msg,showCancel:!1,confirmText:"立即设置",success:function(t){t.confirm&&e.redirectTo({url:"/pagesworktime/salarysettings?type="+r.salaryType})}})}))},change:function(t){var r=(new Date).getFullYear(),n=(new Date).getMonth()+1,a=(new Date).getDate();r<t.year||r===t.year&&n<1*t.month||r===t.year&&n===1*t.month&&a<t.date?this.$Common.toast("不可记录大于今日的工时"):e.navigateTo({url:"/pagesworktime/worktimerecord?type="+this.salaryType+"&date="+t.fulldate})},setWorktime:function(){e.navigateTo({url:"./salarysettings?type="+this.salaryType})},toPage:function(t){e.navigateTo({url:t})},selectPrev:function(){this.workIndex-=1,this.direction=1;var e=this.currentYear;0===this.currentTab&&-1===this.workIndex&&(this.currentMonth=this.rangeMonth-=1),1===this.currentTab&&(this.currentMonth=this.rangeMonth-=1),0===this.rangeMonth&&(e=this.currentYear=this.currentYear-1,e<=1970&&(e=this.currentYear=1970),this.currentMonth=this.rangeMonth=12,1===this.currentTab&&(this.currentYearShow=this.currentYear+"年"));var t=this.workIndex=-1===this.workIndex?this.range.length-1:this.workIndex,r=this.cnDateTransferEn(this.range[t]);this.requestData(e,r)},selectNext:function(){this.workIndex+=1,this.direction=2;var e=this.currentYear;0===this.currentTab&&this.workIndex===this.range.length&&(this.currentMonth=this.rangeMonth+=1),1===this.currentTab&&(this.currentMonth=this.rangeMonth+=1),13===this.rangeMonth&&(e=this.currentYear=this.currentYear+1,this.currentMonth=this.rangeMonth=1,1===this.currentTab&&(this.currentYearShow=this.currentYear+"年"));var t=this.workIndex=this.workIndex>=this.range.length?0:this.workIndex,r=this.cnDateTransferEn(this.range[t]);this.requestData(e,r)},monthSwitch:function(e){console.log("monthSwitchs 返回:",e),this.workIndex=0;var t=e.year+"-"+e.month+"-1 00:00:00",r=new Date(e.year,e.month,0).getDate(),n=e.year+"-"+e.month+"-"+r+" 23:59:59";this.currentYear=e.year,1===this.currentTab&&(this.currentYearShow=this.currentYear+"年"),this.currentMonth=this.rangeMonth=e.month,this.generateRangeMonth(),this.getWorkRecordByRange(e.year,e.month+"-1",t,n)},giveValue:function(e,t,n){var a=e?new Date(e):new Date,o=a.getFullYear()+"-"+(a.getMonth()+1)+"-"+(new Date).getDate();this.info.date=r(new Date(o)).fullDate,this.info.startDate="1970-01-01",this.info.endDate="3000-01-01",this.currentMonth=r(a).month,this.info.selected=t},cnDateTransferEn:function(e){if(0===this.currentTab)return this.cnDateTransferEnByCircle(e);e=e.split("-"),-1===e[0].indexOf("日")&&(e[0]+="1日");var t=e[0].replace("月","-").replace("日","");return t},cnDateTransferEnByCircle:function(e){e=e.split("-"),-1===e[0].indexOf("号")&&(e[0]+="1号");var t=this.rangeMonth;1*t<10?t="0"+1*t:t+="";var r=e[0].replace("号","");1*r<10&&(r="0"+r);var n=t+"-"+r;return n},requestData:function(e,t){var r=this,n="",a="",o=[];0===this.currentTab?this.$nextTick((function(){var i=r.currentRange;if(i.indexOf("月底")>-1)o=r.generateStartEndDate(e,t),n=o[0],a=o[1];else{i=i.split("-"),n=r.currentYear+"-"+i[0].replace("月","-").replace("号","")+" 00:00:00";var s=r.currentYear;12===r.rangeMonth&&(s+=1),a=s+"-"+i[1].replace("月","-").replace("号","")+" 23:59:59"}r.getWorkRecordByRange(e,t,n,a)})):(this.currentTab,o=this.generateStartEndDate(e,t),this.getWorkRecordByRange(e,t,o[0],o[1]))},generateStartEndDate:function(e,t){var n=r(e+"-"+t).fullDate+" 00:00:00",a=t.split("-"),o=new Date(e,a[0],0).getDate();o<10&&(o="0"+o);var i=e+"-"+a[0]+"-"+o+" 23:59:59";return[n,i]},getWorkRecordByRange:function(t,r,n,a){var o=this,i=this,s={salaryType:this.salaryType};n&&a?(s.startDate=n,s.endDate=a):s.workIndex=this.workIndex,this.$Request.get(this.$api.worktime.get_work_record_by_range,s).then((function(n){if(-1!=n.code){var s=n.data.list,h=n.data.info,u=n.data.fullwork;o.giveValue(t+"-"+r,h,a);var c={};switch(!1===u.fullWorkDay?o.showFullDay=!1:o.showFullDay=!0,o.fullWorkDay=u.fullWorkDay?1*u.fullWorkDay:0,o.fullWorkSalary=u.fullWorkSalary?1*u.fullWorkSalary:0,(Array.isArray(s)&&s.length||Object.keys(s).length)&&2!==o.salaryType&&(c={hour:s.hour,hourPrice:s.hourPrice,common:s.common,commonRatio:s.commonRatio,weekend:s.weekend,weekendRatio:s.weekendRatio,holiday:s.holiday,holidayRatio:s.holidayRatio,day:s.day}),o.salaryType){case 1:default:o.commonWork=c;break;case 0:o.hourWork=c;break;case 2:console.error(s),o.hourworkList=s}o.showLoading=!1}else e.showModal({title:o.$Config("APPNAME"),content:n.msg,showCancel:!1,confirmText:"立即设置",success:function(t){t.confirm&&e.redirectTo({url:"/pagesworktime/salarysettings?type="+i.salaryType})}})}))},getRangeByPeriod:function(e,t){var r=this.range[this.workIndex],n="",a="";r=r.split("-"),n=e+"-"+t+" 00:00:00";var o=1*t.split("-")[0];r[1].indexOf("下月")>-1&&(o+=1),o<10&&(o="0"+o);var i=r[1].replace(/[^\d]/g,"");return i||(i=new Date(e,1*o,0).getDate()),i<10&&(i="0"+i),a=e+"-"+o+"-"+i+" 23:59:59",[n,a]},open:function(){var e=this;setTimeout((function(){e.showBtn=!1}),350),this.$refs.rangeSelected.open()},confirm:function(e){0!==e.range.data.length?(this.showBtn=!0,this.showDateRange=!0,this.dateRange=e.range.data[0]+"至"+e.range.data[e.range.data.length-1],this.getWorkRecordByRange(e.year,e.month+"-"+e.date,e.range.data[0]+" 00:00:00",e.range.data[e.range.data.length-1]+" 23:59:59")):this.$Common.toast("请指定时间范围")},close:function(){this.showBtn=!0},generateRangeMonth:function(){if(-1!==this.workIndex){var e=this.range[this.workIndex];if(0===this.currentTab)if(e=e.split("-"),e.indexOf("本月底")>-1)this.currentRange=this.rangeMonth+"月"+e[0]+"-"+this.rangeMonth+"月底";else{var t=this.rangeMonth+1;12===this.rangeMonth&&(t=1),this.currentRange=this.rangeMonth+"月"+e[0]+"-"+t+e[1].replace("下","")}else 1===this.currentTab&&(this.currentRange=e)}},resetRange:function(){this.currentYear=(new Date).getFullYear();var e=(new Date).getMonth()+1;0===this.currentTab?(this.workIndex=this.settingWorkIndex-1,this.currentYearShow="",this.currentMonth=this.rangeMonth=e,this.selectNext(),this.generateRangeMonth()):1===this.currentTab?(this.currentYearShow=this.currentYear+"年",this.workIndex=this.range.indexOf(e+"月")-1,this.selectNext(),this.generateRangeMonth()):(this.showDateRange=!1,this.dateRange="")}}};t.default=n}).call(this,r("543d")["default"])},a084:function(e,t,r){},ab3b:function(e,t,r){"use strict";r.d(t,"b",(function(){return a})),r.d(t,"c",(function(){return o})),r.d(t,"a",(function(){return n}));var n={uniIcons:function(){return Promise.all([r.e("common/vendor"),r.e("components/uni-icons/uni-icons")]).then(r.bind(null,"17fc"))},uniCalendar:function(){return Promise.all([r.e("common/vendor"),r.e("uni_modules/uni-calendar/components/uni-calendar/uni-calendar")]).then(r.bind(null,"f39b"))}},a=function(){var e=this,t=e.$createElement,r=(e._self._c,e.showLoading||2!==e.salaryType?null:e.__map(e.hourworkList,(function(t,r){var n=e.__get_orig(t),a=e.hourworkList.length?Math.round(t.count*t.price*100):null;return{$orig:n,g0:a}})));e._isMounted||(e.e0=function(t,r){var n=arguments[arguments.length-1].currentTarget.dataset,a=n.eventParams||n["event-params"];r=a.index;e.currentTab=r}),e.$mp.data=Object.assign({},{$root:{l0:r}})},o=[]},d8d1:function(e,t,r){"use strict";(function(e){r("652a");n(r("66fd"));var t=n(r("4c48"));function n(e){return e&&e.__esModule?e:{default:e}}wx.__webpack_require_UNI_MP_PLUGIN__=r,e(t.default)}).call(this,r("543d")["createPage"])}},[["d8d1","common/runtime","common/vendor"]]]);